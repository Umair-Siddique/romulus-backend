openapi: 3.0.3
info:
  title: Organization API
  version: v1
  description: |
    Comprehensive API for managing organization profiles and related operations.

    **Features:**
    - Organization profile creation with comprehensive validation
    - Multi-branch management with individual file uploads
    - File upload support for documents and images
    - Profile retrieval by organization ID
    - List all organizations with populated user data
    - Profile updates with partial data support and file handling
    - Duplicate profile prevention (educator/organization conflict detection)
    - SIRET number validation for French business registration
    - Dynamic file mapping for branch residence guidelines
    - Automatic coordinate generation with fallback to defaults

    **Authentication & Authorization:**
    - All endpoints require valid JWT authentication token
    - Organization creation and updates require organization role
    - User must have an existing account before creating organization profile
    - Tokens obtained from Authentication API sign-in endpoint

    **File Upload Support:**
    - Profile pictures (jpg, jpeg, png, gif, webp)
    - Branch residence guidelines (jpg, jpeg, png, gif, pdf)
    - Dynamic file mapping for multiple branch documents using pattern: `branches[index][residenceGuidelines]`

    **Branch Management:**
    - At least one branch required per organization
    - Each branch supports individual contact information and guidelines
    - Automatic coordinate generation with fallback defaults
    - Residence guidelines are optional per branch and default to empty string

    **Coordinate Handling:**
    - Attempts to fetch real coordinates using Google Maps Geocoding API
    - Falls back to default coordinates if geocoding fails
    - Default office coordinates: [73.13829207001977, 33.60948427871408]
    - Default branch coordinates: [73.12305647540082, 33.60784209987379]

  contact:
    name: API Support
    email: support@yourapi.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.yourapp.com
    description: Production server
  - url: https://romulus-backend.onrender.com
    description: Staging server
  - url: http://localhost:5000
    description: Development server

tags:
  - name: Organization Management
    description: Organization profile creation and management operations

components:
  schemas:
    # ================================
    # PRIMITIVE TYPES
    # ================================
    ID:
      type: string
      description: MongoDB ObjectId identifier
      example: "60d0fe4f5311236168a109ca"
      pattern: "^[0-9a-fA-F]{24}$"
      minLength: 24
      maxLength: 24

    Email:
      type: string
      format: email
      description: Valid email address (lowercase, trimmed)
      example: "organization@example.com"
      maxLength: 255
      minLength: 5

    PhoneNumber:
      type: string
      description: Phone number in international format
      example: "+1234567890"
      pattern: "^\\+?[1-9]\\d{1,14}$"
      minLength: 10
      maxLength: 15

    Role:
      type: string
      enum: [admin, organization, educator]
      description: User role determining access permissions
      default: organization
      example: organization

    Timestamp:
      type: string
      format: date-time
      description: ISO 8601 timestamp with timezone
      example: "2024-01-15T10:30:00.000Z"

    DocumentUrl:
      type: string
      description: URL or file path for uploaded documents
      example: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835697/users/684a9654caa07bcde4138271/document.pdf"
      pattern: "^https?:\\/\\/.+\\.(jpg|jpeg|png|gif|pdf)$"

    ImageUrl:
      type: string
      description: URL or file path for uploaded images
      example: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749839528/users/684a9654caa07bcde4138271/avatar.png"
      pattern: "^https?:\\/\\/.+\\.(jpg|jpeg|png|gif|webp)$"

    SiretNumber:
      type: string
      description: French SIRET business registration number (14 digits)
      example: "12345678901234"
      pattern: "^\\d{14}$"
      minLength: 14
      maxLength: 14

    OrganizationStatus:
      type: string
      enum: [active, inactive, pending]
      description: Organization status
      default: pending
      example: pending

    # ================================
    # RESPONSE STRUCTURES
    # ================================
    BaseResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: Indicates if the operation completed successfully
        message:
          type: string
          description: Human-readable response message
          example: "Operation completed successfully"

    ErrorResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            success:
              example: false
            message:
              example: "An error occurred processing your request"

    # ================================
    # USER RELATED SCHEMAS
    # ================================
    UserProfile:
      type: object
      required:
        - _id
        - email
        - role
        - isEmailVerified
        - isPhoneVerified
        - createdAt
        - updatedAt
      properties:
        _id:
          $ref: "#/components/schemas/ID"
        email:
          $ref: "#/components/schemas/Email"
        phone:
          allOf:
            - $ref: "#/components/schemas/PhoneNumber"
          nullable: true
          description: Phone number (optional for organizations in user model)
        role:
          $ref: "#/components/schemas/Role"
        isEmailVerified:
          type: boolean
          description: Email verification status
          example: true
        isPhoneVerified:
          type: boolean
          description: Phone verification status
          example: false
        createdAt:
          $ref: "#/components/schemas/Timestamp"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"
        __v:
          type: integer
          description: MongoDB version key
          example: 0

    # ================================
    # BRANCH SCHEMAS
    # ================================
    Branch:
      type: object
      required:
        - branchName
        - branchEmail
        - branchAddress
        - branchAddressCoordinates
      properties:
        branchName:
          type: string
          description: Name of the branch location
          example: "Downtown Branch"
          minLength: 2
          maxLength: 100
        branchEmail:
          type: string
          format: email
          description: Contact email for this branch (lowercase, validated)
          example: "downtown@example.com"
        branchPhone:
          $ref: "#/components/schemas/PhoneNumber"
          description: Contact phone for this branch (optional)
          nullable: true
        branchCity:
          type: string
          description: City where branch is located (optional)
          example: "Paris"
          minLength: 2
          maxLength: 100
          nullable: true
        branchCountry:
          type: string
          description: Country where branch is located (optional)
          example: "France"
          minLength: 2
          maxLength: 100
          nullable: true
        branchAddress:
          type: string
          description: Complete address of the branch
          example: "123 Business St, Downtown District, Paris 75001"
          minLength: 10
          maxLength: 500
        branchAddressCoordinates:
          type: object
          description: Geographic coordinates for the branch address (attempts real geocoding, falls back to defaults)
          required:
            - type
            - coordinates
          properties:
            type:
              type: string
              enum: [Point]
              default: "Point"
              description: GeoJSON type for point location
            coordinates:
              type: array
              description: Array of [longitude, latitude] coordinates
              items:
                type: number
              minItems: 2
              maxItems: 2
              example: [73.12305647540082, 33.60784209987379]
              default: [73.12305647540082, 33.60784209987379]
        residenceGuidelines:
          type: string
          description: Residence guidelines document for this branch (optional, defaults to empty string)
          example: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835697/users/684a9654caa07bcde4138271/branches%5B0%5D%5BresidenceGuidelines%5D.png"
          default: ""

    BranchCreateRequest:
      type: object
      required:
        - branchName
        - branchEmail
        - branchAddress
      properties:
        branchName:
          type: string
          description: Name of the branch location
          minLength: 2
          maxLength: 100
        branchEmail:
          type: string
          format: email
          description: Contact email for this branch
        branchPhone:
          $ref: "#/components/schemas/PhoneNumber"
          description: Contact phone for this branch (optional)
        branchCity:
          type: string
          description: City where branch is located (optional)
          minLength: 2
          maxLength: 100
        branchCountry:
          type: string
          description: Country where branch is located (optional)
          minLength: 2
          maxLength: 100
        branchAddress:
          type: string
          description: Complete address of the branch
          minLength: 10
          maxLength: 500

    # ================================
    # ORGANIZATION SCHEMAS
    # ================================
    OrganizationProfile:
      type: object
      required:
        - _id
        - user
        - organizationName
        - foundedYear
        - phone
        - siretNumber
        - city
        - country
        - officeAddress
        - officeAddressCoordinates
        - branches
        - status
        - createdAt
        - updatedAt
      properties:
        _id:
          $ref: "#/components/schemas/ID"
        user:
          oneOf:
            - $ref: "#/components/schemas/ID"
            - $ref: "#/components/schemas/UserProfile"
          description: Associated user account (ObjectId in create response, populated object in get responses)
        avatar:
          $ref: "#/components/schemas/ImageUrl"
          description: Organization avatar URL
          default: "https://example.com/default-profile-picture.png"
        organizationName:
          type: string
          description: Official name of the organization
          example: "Global Education Solutions"
          minLength: 2
          maxLength: 100
        foundedYear:
          type: string
          format: date-time
          description: Year when the organization was founded (1900-current year, stored as ISO datetime)
          example: "1998-11-16T00:00:00.000Z"
        phone:
          $ref: "#/components/schemas/PhoneNumber"
          description: Primary contact phone number (required in organization model)
        siretNumber:
          $ref: "#/components/schemas/SiretNumber"
          description: French SIRET business registration number
        city:
          type: string
          description: City where main office is located
          example: "Paris"
          minLength: 2
          maxLength: 100
        country:
          type: string
          description: Country where main office is located
          example: "France"
          minLength: 2
          maxLength: 100
        officeAddress:
          type: string
          description: Complete address of main office
          example: "456 Corporate Blvd, Business District, Paris 75008"
          minLength: 10
          maxLength: 500
        officeAddressCoordinates:
          type: object
          description: Geographic coordinates for the office address (attempts real geocoding, falls back to defaults)
          required:
            - type
            - coordinates
          properties:
            type:
              type: string
              enum: [Point]
              default: "Point"
              description: GeoJSON type for point location
            coordinates:
              type: array
              description: Array of [longitude, latitude] coordinates
              items:
                type: number
              minItems: 2
              maxItems: 2
              example: [73.13829207001977, 33.60948427871408]
              default: [73.13829207001977, 33.60948427871408]
        branches:
          type: array
          description: Array of branch locations (minimum 1 required)
          items:
            $ref: "#/components/schemas/Branch"
          minItems: 1
          example:
            - branchName: "Downtown Branch"
              branchEmail: "downtown@example.com"
              branchPhone: "+33123456789"
              branchCity: "Paris"
              branchCountry: "France"
              branchAddress: "123 Business St, Downtown District, Paris 75001"
              branchAddressCoordinates:
                type: "Point"
                coordinates: [73.12305647540082, 33.60784209987379]
              residenceGuidelines: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835697/users/684a9654caa07bcde4138271/branches%5B0%5D%5BresidenceGuidelines%5D.png"
        status:
          $ref: "#/components/schemas/OrganizationStatus"
        createdAt:
          $ref: "#/components/schemas/Timestamp"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"
        __v:
          type: integer
          description: MongoDB version key
          example: 0

    # ================================
    # REQUEST SCHEMAS
    # ================================
    OrganizationCreateRequest:
      type: object
      required:
        - user
        - organizationName
        - foundedYear
        - phone
        - siretNumber
        - city
        - country
        - officeAddress
        - branches
      properties:
        user:
          $ref: "#/components/schemas/ID"
          description: ID of the associated user account
        avatar:
          type: string
          format: binary
          description: Organization avatar file (jpg, jpeg, png, gif, webp)
        organizationName:
          type: string
          description: Official name of the organization
          minLength: 2
          maxLength: 100
        foundedYear:
          type: string
          format: date
          description: Year when organization was founded (1900-current year)
        phone:
          $ref: "#/components/schemas/PhoneNumber"
          description: Primary contact phone number
        siretNumber:
          $ref: "#/components/schemas/SiretNumber"
          description: French SIRET business registration number
        city:
          type: string
          description: City where main office is located
          minLength: 2
          maxLength: 100
        country:
          type: string
          description: Country where main office is located
          minLength: 2
          maxLength: 100
        officeAddress:
          type: string
          description: Complete address of main office
          minLength: 10
          maxLength: 500
        branches:
          type: array
          description: Array of branch locations (minimum 1 required)
          items:
            $ref: "#/components/schemas/BranchCreateRequest"
          minItems: 1
      description: |
        Organization profile creation data with file upload support.

        **File Upload Fields:**
        - avatar: Organization profile image
        - branches[0][residenceGuidelines]: Residence guidelines for first branch
        - branches[1][residenceGuidelines]: Residence guidelines for second branch
        - etc. (dynamic based on number of branches)

        **Branch Array Processing:**
        - Each branch must have name, email, and address
        - Phone, city, country are optional for branches
        - Residence guidelines files are mapped dynamically to each branch
        - Branch subdocuments do not have _id fields (disabled in schema)

        **Coordinate Generation:**
        - Attempts to fetch real coordinates using Google Maps Geocoding API
        - Falls back to default coordinates if geocoding fails
        - Office default: [73.13829207001977, 33.60948427871408]
        - Branch default: [73.12305647540082, 33.60784209987379]

    OrganizationUpdateRequest:
      type: object
      description: Partial update request - at least one field required. Supports file uploads for avatar and branch residence guidelines.
      properties:
        avatar:
          type: string
          format: binary
          description: Updated organization avatar file (jpg, jpeg, png, gif, webp)
        organizationName:
          type: string
          description: Official name of the organization
          minLength: 2
          maxLength: 100
        foundedYear:
          type: string
          format: date
          description: Year when organization was founded (1900-current year)
        phone:
          $ref: "#/components/schemas/PhoneNumber"
          description: Primary contact phone number
        siretNumber:
          $ref: "#/components/schemas/SiretNumber"
          description: French SIRET business registration number
        city:
          type: string
          description: City where main office is located
          minLength: 2
          maxLength: 100
        country:
          type: string
          description: Country where main office is located
          minLength: 2
          maxLength: 100
        officeAddress:
          type: string
          description: Complete address of main office (triggers coordinate regeneration)
          minLength: 10
          maxLength: 500
        branches:
          type: array
          description: Array of branch locations (replaces entire branches array)
          items:
            $ref: "#/components/schemas/BranchCreateRequest"
          minItems: 1

    # ================================
    # RESPONSE SCHEMAS
    # ================================
    OrganizationCreateData:
      type: object
      description: Organization profile data in create response (user field as ObjectId)
      allOf:
        - $ref: "#/components/schemas/OrganizationProfile"
        - type: object
          properties:
            user:
              $ref: "#/components/schemas/ID"
              description: Associated user account ObjectId

    OrganizationCreateResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/OrganizationCreateData"
          example:
            success: true
            message: "Organization profile created successfully."
            data:
              _id: "684c742fb41d25d0e5997b13"
              user: "684a9654caa07bcde4138271"
              avatar: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749839528/users/684a9654caa07bcde4138271/avatar.png"
              organizationName: "Global Education Solutions"
              foundedYear: "1998-11-16T00:00:00.000Z"
              phone: "+923368856575"
              siretNumber: "12345678901234"
              city: "Islamabad"
              country: "Pakistan"
              officeAddress: "Islamabad, Pakistan"
              officeAddressCoordinates:
                type: "Point"
                coordinates: [73.13829207001977, 33.60948427871408]
              branches:
                - branchName: "Downtown Branch"
                  branchEmail: "downtown@example.com"
                  branchPhone: "+1234688941"
                  branchCity: "Islamabad"
                  branchCountry: "Pakistan"
                  branchAddress: "Islamabad, Pakistan"
                  branchAddressCoordinates:
                    type: "Point"
                    coordinates: [73.12305647540082, 33.60784209987379]
                  residenceGuidelines: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835697/users/684a9654caa07bcde4138271/branches%5B0%5D%5BresidenceGuidelines%5D.png"
              status: "pending"
              createdAt: "2025-06-13T18:55:43.735Z"
              updatedAt: "2025-06-13T18:55:43.735Z"
              __v: 0

    OrganizationListResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/OrganizationProfile"
          example:
            success: true
            message: "Organizations retrieved successfully."

    OrganizationSingleResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/OrganizationProfile"
          example:
            success: true
            message: "Organization retrieved successfully."

    OrganizationUpdateResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/OrganizationProfile"
          example:
            success: true
            message: "Organization updated successfully."

  parameters:
    OrganizationIdPath:
      in: path
      name: id
      required: true
      description: MongoDB ObjectId of the organization profile
      schema:
        $ref: "#/components/schemas/ID"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from the authentication sign-in endpoint.
        Include in the Authorization header as: `Bearer <token>`

  responses:
    # ================================
    # SUCCESS RESPONSES
    # ================================
    OrganizationCreateSuccess:
      description: Organization profile created successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OrganizationCreateResponse"

    OrganizationListSuccess:
      description: Organizations list retrieved successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OrganizationListResponse"

    OrganizationProfileResponse:
      description: Organization profile retrieved successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OrganizationSingleResponse"
          example:
            success: true
            message: "Organization retrieved successfully."
            data:
              _id: "684c742fb41d25d0e5997b13"
              user:
                _id: "684a9654caa07bcde4138271"
                email: "organization@example.com"
                role: "organization"
                isEmailVerified: true
                isPhoneVerified: true
                createdAt: "2025-06-12T08:56:52.808Z"
                updatedAt: "2025-06-12T08:56:52.808Z"
                __v: 0
              avatar: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749839528/users/684a9654caa07bcde4138271/avatar.png"
              organizationName: "Global Education Solutions"
              foundedYear: "1998-11-16T00:00:00.000Z"
              phone: "+923368856575"
              siretNumber: "12345678901234"
              city: "Islamabad"
              country: "Pakistan"
              officeAddress: "Islamabad, Pakistan"
              officeAddressCoordinates:
                type: "Point"
                coordinates: [73.13829207001977, 33.60948427871408]
              branches:
                - branchName: "Downtown Branch"
                  branchEmail: "downtown@example.com"
                  branchPhone: "+1234688941"
                  branchCity: "Islamabad"
                  branchCountry: "Pakistan"
                  branchAddress: "Islamabad, Pakistan"
                  branchAddressCoordinates:
                    type: "Point"
                    coordinates: [73.12305647540082, 33.60784209987379]
                  residenceGuidelines: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835697/users/684a9654caa07bcde4138271/branches%5B0%5D%5BresidenceGuidelines%5D.png"
                - branchName: "Suburb Branch"
                  branchEmail: "suburb@example.com"
                  branchPhone: "+1234688941"
                  branchCity: "Lyon"
                  branchCountry: "France"
                  branchAddress: "789 Education Ave, Lyon 69001"
                  branchAddressCoordinates:
                    type: "Point"
                    coordinates: [73.12305647540082, 33.60784209987379]
                  residenceGuidelines: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835697/users/684a9654caa07bcde4138271/branches%5B1%5D%5BresidenceGuidelines%5D.png"
              status: "pending"
              createdAt: "2025-06-13T18:55:43.735Z"
              updatedAt: "2025-06-13T18:55:43.735Z"
              __v: 0

    OrganizationUpdateSuccess:
      description: Organization profile updated successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OrganizationUpdateResponse"

    # ================================
    # ERROR RESPONSES
    # ================================
    BadRequest:
      description: Invalid request data or business logic violation
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            validationError:
              summary: Field validation failed
              value:
                success: false
                message: "Organization name must be at least 2 characters"
            foundedYearValidation:
              summary: Founded year validation failed
              value:
                success: false
                message: "Founded year must be between 1900 and the current year"
            siretValidation:
              summary: SIRET number validation failed
              value:
                success: false
                message: "SIRET number must be exactly 14 digits"
            profileExists:
              summary: Organization profile already exists
              value:
                success: false
                message: "User already has organization profile."
            educatorConflict:
              summary: User has educator profile
              value:
                success: false
                message: "User already has educator profile."
            branchesRequired:
              summary: Branches validation failed
              value:
                success: false
                message: "At least one branch is required"
            updateMinFields:
              summary: Update requires at least one field
              value:
                success: false
                message: "At least one field must be provided for update."

    Unauthorized:
      description: Authentication failed or invalid credentials
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            missingToken:
              summary: No authentication token provided
              value:
                success: false
                message: "Authorization token missing or malformed"
            invalidToken:
              summary: Token expired or malformed
              value:
                success: false
                message: "Invalid or expired token"

    Forbidden:
      description: Insufficient permissions for the operation
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            roleRequired:
              summary: Organization role required
              value:
                success: false
                message: "Access denied: organization role required"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            userNotFound:
              summary: Associated user account not found
              value:
                success: false
                message: "User does not exist."
            organizationNotFound:
              summary: Organization profile not found
              value:
                success: false
                message: "Organization not found."

    InternalServerError:
      description: Unexpected server error occurred
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            profileCreationFailed:
              summary: Database operation failed
              value:
                success: false
                message: "Failed to create organization."
            profileUpdateFailed:
              summary: Database update operation failed
              value:
                success: false
                message: "Failed to update organization."

security:
  - BearerAuth: []

paths:
  /api/v1/organizations:
    post:
      summary: Create organization profile
      description: |
        Creates a comprehensive organization profile for an existing user account.

        **Prerequisites:**
        - Valid JWT authentication token
        - User must have organization role
        - Existing user account (referenced by user ID)
        - User must not have existing educator or organization profile

        **File Upload Support:**
        - Content-Type: multipart/form-data
        - Supported formats: jpg, jpeg, png, gif, webp (images), pdf (documents)
        - Files are processed and stored with generated paths
        - Dynamic file mapping for branch residence guidelines using pattern: `branches[index][residenceGuidelines]`

        **Validation Rules:**
        - Founded year must be between 1900 and current year (stored as Date object)
        - SIRET number must be exactly 14 digits
        - At least one branch required with name, email, and address
        - All text fields are trimmed and validated for length
        - Phone numbers must be in international format
        - Branch emails are converted to lowercase and validated

        **Business Logic:**
        - Prevents duplicate organization profiles per user
        - Prevents organization profile if user has educator profile
        - Processes branch array with dynamic file mappings using `rest` parameter spreading
        - Maps residence guidelines files to branches using dynamic keys
        - Automatically generates coordinates using Google Maps API with fallback to defaults
        - Branch subdocuments have _id generation disabled
        - Residence guidelines default to empty string if no file provided

        **Coordinate Generation:**
        - Attempts real geocoding using Google Maps Geocoding API
        - Falls back to defaults if geocoding fails
        - Office default coordinates: [73.13829207001977, 33.60948427871408]
        - Branch default coordinates: [73.12305647540082, 33.60784209987379]

      operationId: create-organization-profile
      tags: [Organization Management]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/OrganizationCreateRequest"
            examples:
              completeProfile:
                summary: Complete organization profile with multiple branches
                value:
                  user: "60d0fe4f5311236168a109ca"
                  organizationName: "Global Education Solutions"
                  foundedYear: "2010-01-01"
                  phone: "+33123456789"
                  siretNumber: "12345678901234"
                  city: "Paris"
                  country: "France"
                  officeAddress: "456 Corporate Blvd, Business District, Paris 75008"
                  branches:
                    - branchName: "Downtown Branch"
                      branchEmail: "downtown@example.com"
                      branchPhone: "+33123456789"
                      branchCity: "Paris"
                      branchCountry: "France"
                      branchAddress: "123 Business St, Downtown District, Paris 75001"
                    - branchName: "Suburb Branch"
                      branchEmail: "suburb@example.com"
                      branchAddress: "789 Education Ave, Suburb District, Lyon 69001"
              minimalProfile:
                summary: Minimal required fields only
                value:
                  user: "60d0fe4f5311236168a109ca"
                  organizationName: "Simple Learning Center"
                  foundedYear: "2015-01-01"
                  phone: "+33987654321"
                  siretNumber: "98765432109876"
                  city: "Lyon"
                  country: "France"
                  officeAddress: "321 Simple St, Lyon 69002"
                  branches:
                    - branchName: "Main Branch"
                      branchEmail: "main@simple.com"
                      branchAddress: "321 Simple St, Lyon 69002"
      responses:
        201:
          $ref: "#/components/responses/OrganizationCreateSuccess"
        400:
          $ref: "#/components/responses/BadRequest"
        401:
          $ref: "#/components/responses/Unauthorized"
        403:
          $ref: "#/components/responses/Forbidden"
        404:
          $ref: "#/components/responses/NotFound"
        500:
          $ref: "#/components/responses/InternalServerError"

    get:
      summary: Get all organization profiles
      description: |
        Retrieves all organization profiles in the system with populated user information.

        **Response Details:**
        - Returns array of complete organization profiles
        - Each profile includes populated user object with email, role, verification status
        - All branches with their respective details and file URLs
        - All document URLs and file paths are included in response
        - Returns empty array with success message if no organizations exist

        **Authentication:**
        - Requires valid JWT authentication token
        - No specific role requirements (any authenticated user can access)

        **Use Cases:**
        - List all available organizations
        - Admin dashboard for organization management
        - Browse organizations for partnerships or connections
        - Public organization directory display

        **Error Handling:**
        - Returns empty array if no organizations exist (no 404 error)
        - Returns 401 for authentication failures
        - Returns 500 for unexpected server errors

      operationId: get-all-organizations
      tags: [Organization Management]
      security:
        - BearerAuth: []
      responses:
        200:
          $ref: "#/components/responses/OrganizationListSuccess"
        401:
          $ref: "#/components/responses/Unauthorized"
        500:
          $ref: "#/components/responses/InternalServerError"

  /api/v1/organizations/{id}:
    get:
      summary: Get organization profile by ID
      description: |
        Retrieves an organization profile by its MongoDB ObjectId.

        **Response Details:**
        - Returns complete organization profile with populated user information
        - User object includes email, role, verification status, and timestamps
        - All branches with their respective details and file URLs
        - All document URLs and file paths are included in response
        - Branch subdocuments do not include _id fields

        **Use Cases:**
        - Display organization profile information
        - Verify organization account exists
        - Retrieve profile for editing or updates
        - Access branch details and residence guidelines

      operationId: get-organization-by-id
      tags: [Organization Management]
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrganizationIdPath"
      responses:
        200:
          $ref: "#/components/responses/OrganizationProfileResponse"
        401:
          $ref: "#/components/responses/Unauthorized"
        404:
          $ref: "#/components/responses/NotFound"
        500:
          $ref: "#/components/responses/InternalServerError"

    patch:
      summary: Update organization profile
      description: |
        Updates an existing organization profile with partial data and file uploads.

        **Prerequisites:**
        - Valid JWT authentication token
        - User must have organization role
        - Organization must exist in the system

        **Update Rules:**
        - At least one field must be provided for update
        - All validation rules apply to updated fields
        - File uploads supported for avatar and document updates
        - Uses findByIdAndUpdate with new: true and runValidators: true
        - Branch array processing with dynamic file mappings
        - Coordinate regeneration for address updates

        **File Upload Support:**
        - Content-Type: multipart/form-data
        - Supports avatar updates and branch residence guidelines
        - Dynamic file mapping for branch documents using pattern: `branches[index][residenceGuidelines]`
        - Files replace existing document URLs when provided

        **Validation:**
        - Founded year validation applies if foundedYear is updated
        - SIRET number validation if siretNumber is updated
        - All text field length validations apply
        - Phone number format validation applies
        - Branch email format and lowercase conversion

        **Business Logic:**
        - Profile must exist before update
        - File uploads replace existing document URLs
        - Branch updates replace entire branches array
        - Address updates trigger coordinate regeneration with fallback
        - Response includes updated profile data with populated user
        - Same dynamic file mapping logic as creation

        **Coordinate Handling:**
        - Office address updates trigger coordinate regeneration
        - Branch address updates trigger coordinate regeneration
        - Falls back to defaults if geocoding fails
        - Office default: [73.13829207001977, 33.60948427871408]
        - Branch default: [73.12305647540082, 33.60784209987379]

      operationId: update-organization-profile
      tags: [Organization Management]
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/OrganizationIdPath"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/OrganizationUpdateRequest"
            examples:
              partialUpdate:
                summary: Update selected fields
                value:
                  organizationName: "Updated Organization Name"
                  phone: "+33999888777"
                  city: "Updated City"
              branchUpdate:
                summary: Update branches with address change
                value:
                  branches:
                    - branchName: "Updated Branch"
                      branchEmail: "updated@example.com"
                      branchAddress: "Updated Branch Address, New City 12345"
              fullUpdate:
                summary: Update multiple organization fields
                value:
                  organizationName: "Comprehensive Education Network"
                  foundedYear: "2005-01-01"
                  phone: "+33888777666"
                  city: "Marseille"
                  country: "France"
                  officeAddress: "789 New Corporate Ave, Marseille 13001"
                  branches:
                    - branchName: "Central Branch"
                      branchEmail: "central@example.com"
                      branchPhone: "+33888777666"
                      branchCity: "Marseille"
                      branchCountry: "France"
                      branchAddress: "456 Central Ave, Marseille 13001"
                    - branchName: "Coastal Branch"
                      branchEmail: "coastal@example.com"
                      branchAddress: "789 Coastal Rd, Nice 06000"
      responses:
        200:
          $ref: "#/components/responses/OrganizationUpdateSuccess"
        400:
          $ref: "#/components/responses/BadRequest"
        401:
          $ref: "#/components/responses/Unauthorized"
        403:
          $ref: "#/components/responses/Forbidden"
        404:
          $ref: "#/components/responses/NotFound"
        500:
          $ref: "#/components/responses/InternalServerError"
