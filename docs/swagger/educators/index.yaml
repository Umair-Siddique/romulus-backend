openapi: 3.0.3
info:
  title: Educator API
  version: v1
  description: |
    Comprehensive API for managing educator profiles and related operations.

    **Features:**
    - Educator profile creation with comprehensive validation
    - File upload support for documents and images
    - Profile retrieval by ID or user ID
    - Profile updates with partial data support
    - List all educators with populated user data
    - Nearby educators search with geospatial queries
    - Duplicate profile prevention (educator/organization conflict detection)
    - Skill management with flexible input formats

    **Authentication & Authorization:**
    - All endpoints require valid JWT authentication token
    - Educator creation and updates require educator role
    - Nearby search requires organization role
    - User must have an existing account before creating educator profile
    - Tokens obtained from Authentication API sign-in endpoint

    **File Upload Support:**
    - Profile pictures (jpg, jpeg, png, gif, webp)
    - Identity proof documents (jpg, jpeg, png, gif, pdf)
    - Criminal record documents (jpg, jpeg, png, gif, pdf)
    - Certificates and diplomas (jpg, jpeg, png, gif, pdf)

  contact:
    name: API Support
    email: support@yourapi.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.yourapp.com
    description: Production server
  - url: https://romulus-backend.onrender.com
    description: Staging server
  - url: http://localhost:5000
    description: Development server

tags:
  - name: Educator Management
    description: Educator profile creation and management operations

components:
  schemas:
    # ================================
    # PRIMITIVE TYPES
    # ================================
    ID:
      type: string
      description: MongoDB ObjectId identifier
      example: "60d0fe4f5311236168a109ca"
      pattern: "^[0-9a-fA-F]{24}$"
      minLength: 24
      maxLength: 24

    Email:
      type: string
      format: email
      description: Valid email address (lowercase, trimmed)
      example: "educator@example.com"
      maxLength: 255
      minLength: 5

    PhoneNumber:
      type: string
      description: Phone number in international format
      example: "+1234567890"
      pattern: "^\\+?[1-9]\\d{1,14}$"
      minLength: 10
      maxLength: 15

    Role:
      type: string
      enum: [admin, organization, educator]
      description: User role determining access permissions
      default: educator
      example: educator

    Gender:
      type: string
      enum: [male, female, other]
      description: Gender identification (lowercase in storage)
      example: female

    Timestamp:
      type: string
      format: date-time
      description: ISO 8601 timestamp with timezone
      example: "2024-01-15T10:30:00.000Z"

    DocumentUrl:
      type: string
      description: URL or file path for uploaded documents
      example: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835852/users/684a460b15669c37873dfb06/identityProof.png"
      pattern: "^https?:\\/\\/.+\\.(jpg|jpeg|png|gif|pdf)$"

    ImageUrl:
      type: string
      description: URL or file path for uploaded images
      example: "https://res.cloudinary.com/deqmyyywf/image/upload/v1749835851/users/684a460b15669c37873dfb06/avatar.png"
      pattern: "^https?:\\/\\/.+\\.(jpg|jpeg|png|gif|webp)$"

    # ================================
    # RESPONSE STRUCTURES
    # ================================
    BaseResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: Indicates if the operation completed successfully
        message:
          type: string
          description: Human-readable response message
          example: "Operation completed successfully"

    ErrorResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            success:
              example: false
            message:
              example: "An error occurred processing your request"

    # ================================
    # USER RELATED SCHEMAS
    # ================================
    UserProfile:
      type: object
      required:
        - _id
        - email
        - role
        - isEmailVerified
        - isPhoneVerified
        - createdAt
        - updatedAt
      properties:
        _id:
          $ref: "#/components/schemas/ID"
        email:
          $ref: "#/components/schemas/Email"
        phone:
          allOf:
            - $ref: "#/components/schemas/PhoneNumber"
          nullable: true
          description: Phone number (required for educators)
        role:
          $ref: "#/components/schemas/Role"
        isEmailVerified:
          type: boolean
          description: Email verification status
          example: true
        isPhoneVerified:
          type: boolean
          description: Phone verification status (required for educators)
          example: false
        createdAt:
          $ref: "#/components/schemas/Timestamp"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"
        __v:
          type: integer
          description: MongoDB version key
          example: 0

    # ================================
    # MISSION RELATED SCHEMAS
    # ================================
    MissionInvitation:
      type: object
      required:
        - mission
        - invitationStatus
      properties:
        mission:
          oneOf:
            - $ref: "#/components/schemas/ID"
            - type: object
              description: Populated mission object (excludes hiredEducators, invitedEducators, rejectedEducators)
        invitationStatus:
          type: string
          enum: [pending, accepted, declined]
          default: pending
          description: Status of the mission invitation
        responseTime:
          type: string
          format: date-time
          description: Timestamp when educator responded to invitation
          nullable: true
          default: null

    # ================================
    # ORGANIZATION FEEDBACK SCHEMAS
    # ================================
    OrganizationFeedback:
      type: object
      required:
        - organization
        - feedback
        - rating
      properties:
        organization:
          $ref: "#/components/schemas/ID"
          description: Organization ID providing the feedback
        feedback:
          type: string
          description: Feedback text from organization
          maxLength: 500
          example: "Excellent teaching skills and great communication with students"
        rating:
          type: number
          description: Rating from organization (1-5)
          minimum: 1
          maximum: 5
          example: 5

    # ================================
    # EDUCATOR SCHEMAS
    # ================================
    EducatorProfile:
      type: object
      required:
        - _id
        - user
        - firstName
        - lastName
        - gender
        - dateOfBirth
        - city
        - country
        - fullAddress
        - fullAddressCoordinates
        - profession
        - hourlyRate
        - skills
        - education
        - identityProof
        - criminalRecord
        - status
        - createdAt
        - updatedAt
      properties:
        _id:
          $ref: "#/components/schemas/ID"
        user:
          oneOf:
            - $ref: "#/components/schemas/ID"
            - $ref: "#/components/schemas/UserProfile"
          description: Associated user account (ObjectId in create response, populated object in get responses)
        avatar:
          $ref: "#/components/schemas/ImageUrl"
          description: Avatar URL
          default: "https://example.com/default-profile-picture.png"
        firstName:
          type: string
          description: Educator's first name
          example: "Sarah"
          minLength: 2
          maxLength: 50
        lastName:
          type: string
          description: Educator's last name
          example: "Johnson"
          minLength: 2
          maxLength: 50
        gender:
          $ref: "#/components/schemas/Gender"
        dateOfBirth:
          type: string
          format: date-time
          description: Date of birth (age must be 18-100 years, stored as ISO datetime)
          example: "1990-05-15T00:00:00.000Z"
        city:
          type: string
          description: City of residence
          example: "New York"
          minLength: 2
          maxLength: 100
        country:
          type: string
          description: Country of residence
          example: "United States"
          minLength: 2
          maxLength: 100
        fullAddress:
          type: string
          description: Complete address
          example: "123 Education St, New York, NY 10001"
          minLength: 10
          maxLength: 500
        fullAddressCoordinates:
          type: object
          description: Geographic coordinates for the full address (retrieved from Google Maps API)
          required:
            - type
            - coordinates
          properties:
            type:
              type: string
              enum: [Point]
              default: "Point"
              description: GeoJSON type for point location
            coordinates:
              type: array
              description: Array of [longitude, latitude] coordinates from Google Maps Geocoding API
              items:
                type: number
              minItems: 2
              maxItems: 2
              example: [73.14474441571859, 33.623802049520755]
        bio:
          type: string
          description: Professional biography
          example: "Experienced mathematics teacher with 10+ years in secondary education"
          maxLength: 500
          nullable: true
        identityProof:
          $ref: "#/components/schemas/DocumentUrl"
          description: Identity verification document (required)
        criminalRecord:
          $ref: "#/components/schemas/DocumentUrl"
          description: Criminal background check document (required)
        profession:
          type: string
          description: Professional title or occupation
          example: "Mathematics Teacher"
          minLength: 2
          maxLength: 100
        hourlyRate:
          type: number
          description: Hourly teaching rate in USD
          example: 35.00
          minimum: 0
          maximum: 10000
        skills:
          type: array
          description: Teaching skills and specializations (normalized to lowercase via pre-save middleware)
          items:
            type: string
            minLength: 1
            maxLength: 50
          example: ["mathematics", "algebra", "calculus", "statistics"]
          minItems: 1
          maxItems: 20
        education:
          type: string
          description: Educational background
          example: "Master's in Mathematics Education, Harvard University"
          minLength: 2
          maxLength: 200
        certificateOfHonor:
          $ref: "#/components/schemas/DocumentUrl"
          description: Certificate of honor or achievement (optional)
          nullable: true
        diploma:
          $ref: "#/components/schemas/DocumentUrl"
          description: Academic diploma or degree certificate (optional)
          nullable: true
        missionsInvitedFor:
          type: array
          description: Array of mission invitations for this educator
          items:
            $ref: "#/components/schemas/MissionInvitation"
          default: []
        missionsHiredFor:
          type: array
          description: Array of mission IDs where educator was hired
          items:
            $ref: "#/components/schemas/ID"
          default: []
        organizationsFeedbacks:
          type: array
          description: Array of feedback from organizations
          items:
            $ref: "#/components/schemas/OrganizationFeedback"
          default: []
        status:
          type: string
          enum: [active, inactive, pending]
          default: pending
          description: Current status of the educator profile
        createdAt:
          $ref: "#/components/schemas/Timestamp"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"
        __v:
          type: integer
          description: MongoDB version key
          example: 0

    # ================================
    # REQUEST SCHEMAS
    # ================================
    EducatorCreateRequest:
      type: object
      required:
        - user
        - firstName
        - lastName
        - gender
        - dateOfBirth
        - city
        - country
        - fullAddress
        - profession
        - hourlyRate
        - skills
        - education
      properties:
        user:
          $ref: "#/components/schemas/ID"
          description: ID of the associated user account
        avatar:
          type: string
          format: binary
          description: Avatar file (jpg, jpeg, png, gif, webp)
        firstName:
          type: string
          description: Educator's first name
          minLength: 2
          maxLength: 50
        lastName:
          type: string
          description: Educator's last name
          minLength: 2
          maxLength: 50
        gender:
          $ref: "#/components/schemas/Gender"
        dateOfBirth:
          type: string
          format: date
          description: Date of birth (must result in age 18-100)
        city:
          type: string
          description: City of residence
          minLength: 2
          maxLength: 100
        country:
          type: string
          description: Country of residence
          minLength: 2
          maxLength: 100
        fullAddress:
          type: string
          description: Complete residential address (coordinates auto-generated via Google Maps API)
          minLength: 10
          maxLength: 500
        bio:
          type: string
          description: Professional biography (optional)
          maxLength: 500
        identityProof:
          type: string
          format: binary
          description: Identity verification document (jpg, jpeg, png, gif, pdf) - required
        criminalRecord:
          type: string
          format: binary
          description: Criminal background check document (jpg, jpeg, png, gif, pdf) - required
        profession:
          type: string
          description: Professional title or occupation
          minLength: 2
          maxLength: 100
        hourlyRate:
          type: number
          description: Hourly teaching rate
          minimum: 0
          maximum: 10000
        skills:
          type: string
          description: Teaching skills (comma-separated string) - parsed via parseDelimitedString utility
          example: "mathematics,algebra,calculus,statistics"
        education:
          type: string
          description: Educational background
          minLength: 2
          maxLength: 200
        certificateOfHonor:
          type: string
          format: binary
          description: Certificate of honor document (jpg, jpeg, png, gif, pdf) - optional
        diploma:
          type: string
          format: binary
          description: Academic diploma file (jpg, jpeg, png, gif, pdf) - optional

    EducatorUpdateRequest:
      type: object
      description: Partial update request - only provided fields will be updated
      properties:
        firstName:
          type: string
          description: Educator's first name
          minLength: 2
          maxLength: 50
        lastName:
          type: string
          description: Educator's last name
          minLength: 2
          maxLength: 50
        gender:
          $ref: "#/components/schemas/Gender"
        dateOfBirth:
          type: string
          format: date
          description: Date of birth (must result in age 18-100)
        city:
          type: string
          description: City of residence
          minLength: 2
          maxLength: 100
        country:
          type: string
          description: Country of residence
          minLength: 2
          maxLength: 100
        fullAddress:
          type: string
          description: Complete residential address
          minLength: 10
          maxLength: 500
        bio:
          type: string
          description: Professional biography
          maxLength: 500
        profession:
          type: string
          description: Professional title or occupation
          minLength: 2
          maxLength: 100
        hourlyRate:
          type: number
          description: Hourly teaching rate
          minimum: 0
          maximum: 10000
        skills:
          type: string
          description: Teaching skills (comma-separated string)
          example: "mathematics,algebra,calculus,statistics"
        education:
          type: string
          description: Educational background
          minLength: 2
          maxLength: 200
        avatar:
          type: string
          format: binary
          description: New avatar file (jpg, jpeg, png, gif, webp)
        identityProof:
          type: string
          format: binary
          description: Updated identity verification document
        criminalRecord:
          type: string
          format: binary
          description: Updated criminal background check document
        certificateOfHonor:
          type: string
          format: binary
          description: Updated certificate of honor document
        diploma:
          type: string
          format: binary
          description: Updated academic diploma file

    # ================================
    # RESPONSE SCHEMAS
    # ================================
    EducatorCreateData:
      type: object
      description: Educator profile data in create response (user field as ObjectId)
      required:
        - _id
        - user
        - firstName
        - lastName
        - gender
        - dateOfBirth
        - city
        - country
        - fullAddress
        - fullAddressCoordinates
        - profession
        - hourlyRate
        - skills
        - education
        - identityProof
        - criminalRecord
        - status
        - createdAt
        - updatedAt
      properties:
        _id:
          $ref: "#/components/schemas/ID"
        user:
          $ref: "#/components/schemas/ID"
          description: Associated user account ObjectId
        avatar:
          $ref: "#/components/schemas/ImageUrl"
          description: Avatar URL (file path from upload middleware)
          nullable: true
        firstName:
          type: string
          description: Educator's first name
          example: "Sharjeel"
        lastName:
          type: string
          description: Educator's last name
          example: "Faiq"
        gender:
          $ref: "#/components/schemas/Gender"
          example: "male"
        dateOfBirth:
          type: string
          format: date-time
          description: Date of birth stored as ISO datetime
          example: "1998-11-16T00:00:00.000Z"
        city:
          type: string
          description: City of residence
          example: "Islamabad"
        country:
          type: string
          description: Country of residence
          example: "Pakistan"
        fullAddress:
          type: string
          description: Complete address
          example: "Islamabad, Pakistan"
        fullAddressCoordinates:
          type: object
          description: Geographic coordinates from Google Maps API
          required:
            - type
            - coordinates
          properties:
            type:
              type: string
              enum: [Point]
              example: "Point"
            coordinates:
              type: array
              description: Array of [longitude, latitude] coordinates
              items:
                type: number
              example: [73.14474441571859, 33.623802049520755]
        bio:
          type: string
          description: Professional biography
          example: "Software Engineer"
          nullable: true
        identityProof:
          $ref: "#/components/schemas/DocumentUrl"
          description: Identity verification document (file path from upload)
        criminalRecord:
          $ref: "#/components/schemas/DocumentUrl"
          description: Criminal background check document (file path from upload)
        profession:
          type: string
          description: Professional title or occupation
          example: "Software Engineer"
        hourlyRate:
          type: number
          description: Hourly teaching rate
          example: 20
        skills:
          type: array
          description: Teaching skills (normalized to lowercase)
          items:
            type: string
          example: ["engineer", "programming", "software development"]
        education:
          type: string
          description: Educational background
          example: "Bachelor of Computer Science"
        certificateOfHonor:
          $ref: "#/components/schemas/DocumentUrl"
          description: Certificate of honor or achievement (file path from upload)
          nullable: true
        diploma:
          $ref: "#/components/schemas/DocumentUrl"
          description: Academic diploma or degree certificate (file path from upload)
          nullable: true
        missionsInvitedFor:
          type: array
          description: Array of mission invitations (empty for new profiles)
          items:
            $ref: "#/components/schemas/MissionInvitation"
          default: []
        missionsHiredFor:
          type: array
          description: Array of mission IDs (empty for new profiles)
          items:
            $ref: "#/components/schemas/ID"
          default: []
        organizationsFeedbacks:
          type: array
          description: Array of feedback from organizations (empty for new profiles)
          items:
            $ref: "#/components/schemas/OrganizationFeedback"
          default: []
        status:
          type: string
          enum: [active, inactive, pending]
          default: pending
          description: Current status of the educator profile
        createdAt:
          $ref: "#/components/schemas/Timestamp"
          example: "2025-06-27T18:29:27.832Z"
        updatedAt:
          $ref: "#/components/schemas/Timestamp"
          example: "2025-06-27T18:29:27.832Z"
        __v:
          type: integer
          description: MongoDB version key
          example: 0

    EducatorCreateResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/EducatorCreateData"
          example:
            success: true
            message: "Educator Profile Created Successfully"
            data:
              user: "685ec9b47d7c68774fab517c"
              avatar: "uploads/avatars/685ec9b47d7c68774fab517c/avatar.jpg"
              firstName: "Sharjeel"
              lastName: "Faiq"
              gender: "male"
              dateOfBirth: "1998-11-16T00:00:00.000Z"
              city: "Islamabad"
              country: "Pakistan"
              fullAddress: "Islamabad, Pakistan"
              fullAddressCoordinates:
                type: "Point"
                coordinates: [73.14474441571859, 33.623802049520755]
              bio: "Software Engineer"
              identityProof: "uploads/documents/685ec9b47d7c68774fab517c/identityProof.pdf"
              criminalRecord: "uploads/documents/685ec9b47d7c68774fab517c/criminalRecord.pdf"
              profession: "Software Engineer"
              hourlyRate: 20
              skills: ["engineer", "programming", "software development"]
              education: "Bachelor of Computer Science"
              certificateOfHonor: "uploads/documents/685ec9b47d7c68774fab517c/certificateOfHonor.pdf"
              diploma: "uploads/documents/685ec9b47d7c68774fab517c/diploma.pdf"
              missionsInvitedFor: []
              missionsHiredFor: []
              organizationsFeedbacks: []
              status: "pending"
              _id: "685ee307dcf7fb2891637d3b"
              createdAt: "2025-06-27T18:29:27.832Z"
              updatedAt: "2025-06-27T18:29:27.832Z"
              __v: 0

    EducatorListResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/EducatorProfile"
          example:
            success: true
            message: "Educators retrieved successfully."

    EducatorSingleResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/EducatorProfile"
          example:
            success: true
            message: "Educator profile retrieved successfully."

    EducatorUpdateResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/EducatorProfile"
          example:
            success: true
            message: "Educator Profile Updated Successfully"

    NearbyEducatorsResponse:
      allOf:
        - $ref: "#/components/schemas/BaseResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/EducatorProfile"
          example:
            success: true
            message: "Nearby educators retrieved successfully."

  parameters:
    EducatorIdPath:
      in: path
      name: id
      required: true
      description: MongoDB ObjectId of the educator profile
      schema:
        $ref: "#/components/schemas/ID"

    CoordinatesQuery:
      in: query
      name: coordinates
      required: true
      description: Comma-separated coordinates (longitude,latitude) for center point - parsed via parseDelimitedString utility
      schema:
        type: string
        example: "73.1447,33.6238"
        pattern: "^-?\\d+\\.\\d+,-?\\d+\\.\\d+$"

    DistanceQuery:
      in: query
      name: distance
      required: true
      description: Search radius in kilometers (converted to meters internally by multiplying by 1000)
      schema:
        type: number
        minimum: 0.1
        maximum: 1000
        example: 10

    SkillsQuery:
      in: query
      name: skills
      required: false
      description: Comma-separated list of skills to filter by (parsed via parseDelimitedString utility, case-insensitive matching)
      schema:
        type: string
        example: "mathematics,physics,chemistry"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from the authentication sign-in endpoint.
        Include in the Authorization header as: `Bearer <token>`

  responses:
    # ================================
    # SUCCESS RESPONSES
    # ================================
    EducatorCreateSuccess:
      description: Educator profile created successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/EducatorCreateResponse"

    EducatorListSuccess:
      description: Educators list retrieved successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/EducatorListResponse"

    EducatorProfileResponse:
      description: Educator profile retrieved successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/EducatorSingleResponse"
          example:
            success: true
            message: "Educator profile retrieved successfully."
            data:
              _id: "684c741db41d25d0e5997b0e"
              user:
                _id: "684a460b15669c37873dfb06"
                email: "educator@example.com"
                role: "educator"
                isEmailVerified: true
                isPhoneVerified: true
                createdAt: "2025-06-12T03:14:19.534Z"
                updatedAt: "2025-06-12T03:15:47.735Z"
                __v: 0
              avatar: "uploads/avatars/684a460b15669c37873dfb06/avatar.png"
              firstName: "Sarah"
              lastName: "Johnson"
              gender: "female"
              dateOfBirth: "1990-05-15T00:00:00.000Z"
              city: "Islamabad"
              country: "Pakistan"
              fullAddress: "Islamabad, Pakistan"
              fullAddressCoordinates:
                type: "Point"
                coordinates: [73.14474441571859, 33.623802049520755]
              bio: "Experienced mathematics teacher with 10+ years in secondary education"
              identityProof: "uploads/documents/684a460b15669c37873dfb06/identityProof.pdf"
              criminalRecord: "uploads/documents/684a460b15669c37873dfb06/criminalRecord.pdf"
              profession: "Mathematics Teacher"
              hourlyRate: 35
              skills: ["mathematics", "algebra", "calculus", "statistics"]
              education: "Master's in Mathematics Education"
              certificateOfHonor: "uploads/documents/684a460b15669c37873dfb06/certificateOfHonor.pdf"
              diploma: "uploads/documents/684a460b15669c37873dfb06/diploma.pdf"
              missionsInvitedFor: []
              missionsHiredFor: []
              organizationsFeedbacks: []
              status: "pending"
              createdAt: "2025-06-13T18:55:25.227Z"
              updatedAt: "2025-06-13T18:55:25.227Z"
              __v: 0

    EducatorUpdateSuccess:
      description: Educator profile updated successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/EducatorUpdateResponse"

    NearbyEducatorsSuccess:
      description: Nearby educators retrieved successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/NearbyEducatorsResponse"

    # ================================
    # ERROR RESPONSES
    # ================================
    BadRequest:
      description: Invalid request data or business logic violation
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            validationError:
              summary: Field validation failed
              value:
                success: false
                message: "First name must be at least 2 characters"
            ageValidation:
              summary: Age validation failed
              value:
                success: false
                message: "Age must be between 18 and 100 years"
            profileExists:
              summary: Educator profile already exists
              value:
                success: false
                message: "User already has educator profile. Log in again."
            organizationConflict:
              summary: User has organization profile
              value:
                success: false
                message: "User already has organization profile."
            invalidSkills:
              summary: Skills validation failed
              value:
                success: false
                message: "At least one skill is required"
            coordinatesError:
              summary: Unable to fetch coordinates from Google Maps API
              value:
                success: false
                message: "Unable to fetch coordinates"

    Unauthorized:
      description: Authentication failed or invalid credentials
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            missingToken:
              summary: No authentication token provided
              value:
                success: false
                message: "Authorization token missing or malformed."
            invalidToken:
              summary: Token expired or malformed
              value:
                success: false
                message: "Invalid or expired token"

    Forbidden:
      description: Insufficient permissions for the operation
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            educatorRoleRequired:
              summary: Educator role required for profile operations
              value:
                success: false
                message: "Access denied: educator role required."
            organizationRoleRequired:
              summary: Organization role required for nearby search
              value:
                success: false
                message: "Access denied: organization role required."

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            userNotFound:
              summary: Associated user account not found
              value:
                success: false
                message: "User does not exist."
            educatorNotFound:
              summary: Educator profile not found
              value:
                success: false
                message: "Educator profile not found."

    InternalServerError:
      description: Unexpected server error occurred
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            profileCreationFailed:
              summary: Database operation failed
              value:
                success: false
                message: "An error occurred while creating the profile."
            profileUpdateFailed:
              summary: Database update operation failed
              value:
                success: false
                message: "An error occurred while updating the profile."

security:
  - BearerAuth: []

paths:
  /api/v1/educators:
    post:
      summary: Create educator profile
      description: |
        Creates a comprehensive educator profile for an existing user account.

        **Prerequisites:**
        - Valid JWT authentication token with educator role
        - Existing user account (referenced by user ID)
        - User must not have existing educator or organization profile

        **File Upload Processing:**
        - Content-Type: multipart/form-data
        - Files processed through upload middleware
        - File paths extracted using getFilePath() utility
        - Supports array format for file uploads

        **Address Geocoding:**
        - fullAddress automatically geocoded using Google Maps API
        - Coordinates stored in fullAddressCoordinates field as GeoJSON Point
        - Uses getCoordinates() utility function for API integration

        **Validation Rules:**
        - Age must be between 18-100 years (calculated from dateOfBirth)
        - At least one skill required (validated in model)
        - Skills normalized to lowercase via pre-save middleware
        - Hourly rate must be between 0-10000
        - Required files: identityProof, criminalRecord

        **Business Logic:**
        - Prevents duplicate educator profiles per user
        - Prevents educator profile if user has organization profile
        - Skills processed via parseDelimitedString utility
        - File uploads handled through getFilePath extraction

      operationId: create-educator-profile
      tags: [Educator Management]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/EducatorCreateRequest"
            examples:
              completeProfile:
                summary: Complete educator profile with all fields
                value:
                  user: "60d0fe4f5311236168a109ca"
                  firstName: "Sarah"
                  lastName: "Johnson"
                  gender: "female"
                  dateOfBirth: "1990-05-15"
                  city: "New York"
                  country: "United States"
                  fullAddress: "123 Education St, New York, NY 10001"
                  bio: "Experienced mathematics teacher with 10+ years in secondary education"
                  profession: "Mathematics Teacher"
                  hourlyRate: 35.00
                  skills: "mathematics,algebra,calculus,statistics"
                  education: "Master's in Mathematics Education, Harvard University"
              minimalProfile:
                summary: Minimal required fields only
                value:
                  user: "60d0fe4f5311236168a109ca"
                  firstName: "John"
                  lastName: "Smith"
                  gender: "male"
                  dateOfBirth: "1985-03-20"
                  city: "Chicago"
                  country: "United States"
                  fullAddress: "456 Learning Ave, Chicago, IL 60601"
                  profession: "Science Teacher"
                  hourlyRate: 28.00
                  skills: "biology,chemistry"
                  education: "Bachelor's in Biology Education"
      responses:
        201:
          $ref: "#/components/responses/EducatorCreateSuccess"
        400:
          $ref: "#/components/responses/BadRequest"
        401:
          $ref: "#/components/responses/Unauthorized"
        403:
          $ref: "#/components/responses/Forbidden"
        404:
          $ref: "#/components/responses/NotFound"
        500:
          $ref: "#/components/responses/InternalServerError"

    get:
      summary: Get all educator profiles
      description: |
        Retrieves a list of all educator profiles in the system.

        **Response Details:**
        - Returns array of educator profiles with populated user information
        - Uses EducatorModel.find().populate("user") query
        - Each educator object includes complete profile data
        - User objects include email, role, verification status, and timestamps
        - All document URLs and file paths are included in response
        - Includes mission-related fields (missionsInvitedFor, missionsHiredFor)

        **Authentication:**
        - Requires valid JWT authentication token
        - No specific role requirements (any authenticated user can access)

        **Use Cases:**
        - List all available educators for browsing
        - Administrative overview of educator profiles
        - Search and filter functionality base data
        - Public educator directory display

        **Error Handling:**
        - Returns empty array if no educators exist
        - Returns 401 for authentication failures
        - Returns 500 for unexpected server errors

      operationId: get-all-educators
      tags: [Educator Management]
      security:
        - BearerAuth: []
      responses:
        200:
          $ref: "#/components/responses/EducatorListSuccess"
        401:
          $ref: "#/components/responses/Unauthorized"
        500:
          $ref: "#/components/responses/InternalServerError"

  /api/v1/educators/nearby:
    get:
      summary: Find nearby educators with geospatial search
      description: |
        Retrieves educators within a specified distance from given coordinates using MongoDB's geospatial queries.

        **Prerequisites:**
        - Valid JWT authentication token with organization role
        - Coordinates and distance parameters required

        **Geospatial Search Implementation:**
        - Uses MongoDB's $near operator with 2dsphere index
        - Distance converted from kilometers to meters (multiply by 1000)
        - Searches based on fullAddressCoordinates field
        - Returns educators sorted by distance (nearest first)
        - Coordinates parsed via parseDelimitedString utility

        **Skill Filtering:**
        - Optional skills parameter for additional filtering
        - Processes comma-separated skill strings via parseDelimitedString
        - Filters educators whose skills array includes any of the specified skills
        - Case-insensitive matching (skills stored in lowercase)
        - Applied after geospatial query via filterEducatorsBySkills function

        **Response Details:**
        - Returns populated user information for each educator
        - Includes complete educator profile data
        - Empty array returned if no educators found within criteria

      operationId: get-nearby-educators
      tags: [Educator Management]
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/CoordinatesQuery"
        - $ref: "#/components/parameters/DistanceQuery"
        - $ref: "#/components/parameters/SkillsQuery"
      responses:
        200:
          $ref: "#/components/responses/NearbyEducatorsSuccess"
        400:
          $ref: "#/components/responses/BadRequest"
        401:
          $ref: "#/components/responses/Unauthorized"
        403:
          $ref: "#/components/responses/Forbidden"
        500:
          $ref: "#/components/responses/InternalServerError"

  /api/v1/educators/{id}:
    get:
      summary: Get educator profile by ID
      description: |
        Retrieves an educator profile by its MongoDB ObjectId.

        **Query Implementation:**
        - Uses EducatorModel.findOne({ _id: id }) with population
        - Populates user field with complete user object
        - Populates missionsInvitedFor.mission field excluding sensitive data
        - Excludes: hiredEducators, invitedEducators, rejectedEducators from missions

        **Response Details:**
        - Returns complete educator profile with populated user information
        - User object includes email, role, verification status, and timestamps
        - All document URLs and file paths are included in response
        - Includes mission-related data with populated mission objects

        **Use Cases:**
        - Display educator profile information
        - Verify educator account exists
        - Retrieve profile for editing or updates

      operationId: get-educator-by-id
      tags: [Educator Management]
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/EducatorIdPath"
      responses:
        200:
          $ref: "#/components/responses/EducatorProfileResponse"
        401:
          $ref: "#/components/responses/Unauthorized"
        404:
          $ref: "#/components/responses/NotFound"
        500:
          $ref: "#/components/responses/InternalServerError"

    patch:
      summary: Update educator profile
      description: |
        Updates an existing educator profile with partial data.

        **Prerequisites:**
        - Valid JWT authentication token with educator role
        - Educator profile must exist in the system

        **Update Implementation:**
        - Uses EducatorModel.findByIdAndUpdate() for updates
        - Only provided fields are updated (partial update support)
        - File uploads processed through upload middleware
        - Skills processed via parseDelimitedString if provided

        **Validation:**
        - All model validation rules apply to updated fields
        - Age validation applies if dateOfBirth is updated
        - Skills array validation if skills are updated
        - Hourly rate range validation applies
        - Pre-save middleware normalizes skills to lowercase

        **File Handling:**
        - File uploads replace existing document URLs
        - Uses getFilePath() utility for file path extraction
        - Supports all document types: avatar, identityProof, criminalRecord, certificateOfHonor, diploma

        **Business Logic:**
        - Profile must exist before update (404 if not found)
        - Response includes updated profile data
        - Maintains all existing data for non-updated fields

      operationId: update-educator-profile
      tags: [Educator Management]
      security:
        - BearerAuth: []
      parameters:
        - $ref: "#/components/parameters/EducatorIdPath"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/EducatorUpdateRequest"
            examples:
              partialUpdate:
                summary: Update selected fields
                value:
                  firstName: "UpdatedName"
                  hourlyRate: 40.00
                  skills: "mathematics,physics,chemistry"
              bioUpdate:
                summary: Update bio only
                value:
                  bio: "Updated professional biography with new achievements"
              fileUpdate:
                summary: Update files only
                value:
                  avatar: "(binary file data)"
                  certificateOfHonor: "(binary file data)"
      responses:
        200:
          $ref: "#/components/responses/EducatorUpdateSuccess"
        400:
          $ref: "#/components/responses/BadRequest"
        401:
          $ref: "#/components/responses/Unauthorized"
        403:
          $ref: "#/components/responses/Forbidden"
        404:
          $ref: "#/components/responses/NotFound"
        500:
          $ref: "#/components/responses/InternalServerError"
